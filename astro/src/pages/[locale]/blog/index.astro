---
import PageLayout from '../../../layouts/PageLayout.astro';
import Container from '../../../components/ui/Container.astro';
import Card from '../../../components/ui/Card.astro';
import StrapiImage from '../../../components/ui/StrapiImage.astro';
import Pagination from '../../../components/common/Pagination.astro';
import { fetchCollection } from '../../../lib/strapi';
import { LOCALES, t, getLocalePath } from '../../../lib/i18n';
import type { Locale } from '../../../lib/i18n';
import type { BlogPost } from '../../../lib/types';

export async function getStaticPaths() {
  return LOCALES.map((locale) => ({ params: { locale } }));
}

const locale = Astro.params.locale as Locale;

let posts: BlogPost[] = [];
try {
  posts = await fetchCollection<BlogPost>('blog-posts', locale, { 'sort[0]': 'publishedAt:desc' });
} catch {
  // Strapi not available
}
---
<PageLayout locale={locale} title={`Blog | PI Planning`}>
  <section class="py-16 md:py-24">
    <Container>
      <h1 class="text-4xl font-bold text-neutral-900 mb-12">Blog</h1>
      {posts.length > 0 ? (
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {posts.map((post) => (
            <a href={getLocalePath(locale, `/blog/${post.slug}`)} class="group">
              <Card>
                {post.featuredImage && (
                  <StrapiImage image={post.featuredImage} class="w-full h-48 object-cover rounded-lg mb-4" />
                )}
                {post.category && (
                  <span class="inline-block rounded-full bg-primary-100 text-primary-700 px-3 py-1 text-xs font-medium mb-2">
                    {post.category.name}
                  </span>
                )}
                <h2 class="text-lg font-semibold text-neutral-900 group-hover:text-primary-500 transition-colors mb-2">
                  {post.title}
                </h2>
                {post.excerpt && <p class="text-sm text-neutral-600 line-clamp-2">{post.excerpt}</p>}
                <p class="text-sm text-primary-500 font-medium mt-4">{t(locale, 'blog.readMore')} &rarr;</p>
              </Card>
            </a>
          ))}
        </div>
      ) : (
        <p class="text-neutral-600 text-center py-12">Aucun article pour le moment.</p>
      )}
    </Container>
  </section>
</PageLayout>
